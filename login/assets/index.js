function e(e,t,o){t?e.classList.add(o):e.classList.remove(o)}const t={en:{langName:"English",loginTitleLogin:"Login",loginTitleRegister:"Register",form_username:"User Name",form_password:"Password",form_repeat_password:"Repeat Your Password",form_verification_code:"Verify Code",loginStatus:{status:{not_logged_in:"Not logged in",user_name_or_password_not_filled_in:"The user name or password is not entered",the_verification_code_is_not_entered:"The verify code is not entered",attempting_to_login:"Attempting to login……",login_failed:"Login failed, {{error}}",login_succeeded:"Login succeeded ✔",do_not_enter_two_different_passwords:"Don't enter two different passwords",wrong_username_or_password:"Wrong user name or password",wrong_verification_code:"Wrong verify code",please_try_again:"Please try again",password_strength_is_insufficient:"The password is not strong enough. It must contain uppercase and lowercase letters and digits and cannot be less than 12 characters in length",password_too_long:"The password length exceeds 128 characters",incorrect_username_format:"User name format is wrong, it must match the regular expression ^[0-9a-zA-Z\\-_]{1,32}$"}},forgotPassword:"Forgot Password",loginbutton:{status:{login:"Login",register:"Sign Up"}}},"zh-CN":{langName:"简体中文",loginTitleLogin:"登录",loginTitleRegister:"注册",form_username:"用户名",form_password:"密码",form_repeat_password:"重复密码",form_verification_code:"验证码",loginStatus:{status:{not_logged_in:"未登录",user_name_or_password_not_filled_in:"未填写用户名或密码",the_verification_code_is_not_entered:"未填写验证码",attempting_to_login:"正在尝试登录……",login_failed:"登录失败，{{error}}",login_succeeded:"登录成功 ✔",do_not_enter_two_different_passwords:"不能输入两个不同的密码",wrong_username_or_password:"用户名或密码错误",wrong_verification_code:"验证码错误",please_try_again:"请重试",the_username_already_exists:"用户名已存在",password_strength_is_insufficient:"密码强度不足，必须含有大写、小写字母和数字，长度不能小于12",password_too_long:"密码长度超过了128个字符",incorrect_username_format:"用户名格式错误，必须匹配正则表达式 ^[0-9a-zA-Z\\-_]{1,32}$"}},forgotPassword:"忘记密码",loginbutton:{status:{login:"登录",register:"注册"}}}},o=Object.keys(t),n={"en-US":"en","en-GB":"en","zh-Hans-CN":"zh-CN"},s={};var i;const r="BCSPanelI18nLangName";function a(e,o=!1){if("string"!=typeof e&&(e=localStorage.getItem(r)),e&&"default"!==e)return i=Object.keys(t).includes(e)?e:"en",localStorage.setItem(r,i),void(o||d());localStorage.removeItem(r);for(let s of navigator.languages)if(Object.hasOwn(n,s)&&(s=n[s]),Object.hasOwn(t,s))return i=s,void(o||d());i="en",o||d()}function l(){self.divLoginButton.style.height="",self.divLoginButton.style.height=document.getElementsByClassName("loginStatus")[0].offsetHeight+"px";var e=0;if("zh-CN"===i)e=0;else e=292;const t=self.titleBox.classList,o="titleBoxImgHide";self.divmain2.offsetWidth<e+24?t.add(o):t.remove(o)}function d(e,o,n,r=!1){const a=t[i];function d(e,t,o){const n=document.querySelectorAll(`[i18n_id="${e}"]`);if(0==n.length)return;let i=a[e];if("object"==typeof i)if(o?s[e]=o:o=s[e],void 0===t&&(t=n[0].attributes.i18n_statu?.value),i=i.status[t],i){if(o)for(let s in o)i=i.replace(`{{${s}}}`,o[s])}else i=t;for(const s of n){const e=s.attributes?.i18n_statu;if(void 0!==e&&(e.value=t),!r){const e=s.attributes.i18n_property_name.value;s[e]=i;const t=s.attributes.i18n_mirror_elementIds?.value?.split(",");if(t)for(const o of t){const t=document.getElementById(o);t&&(t[e]=i)}}}}if(e)d(e,o,n);else for(let t in a)"langName"!=t&&d(t,o,n);l()}function c(e,t=void 0,o=void 0){d("loginStatus",e,o),void 0!==t&&(self.loginStatus.style.color=t)}function f(e,...t){for(const o of t)o.style.display=e?"":"none"}a(null,!0);var _=!1;function g(){return _}function u(t){if(_==t)return;_=t,f(t,self.repeat_password,self.verification_code),d("loginbutton",t?"register":"login",void 0,!1);const o="loginTitleSelect";e(self.loginTitleLogin,!t,o),e(self.loginTitleRegister,t,o),e(self.password,!t,"inputLastChild")}const m={login_api:"../api-login/login",login_success_redirect(){location.replace("../")}},p=e=>new Promise((t=>{setTimeout(t,e)}));function w(e){self.loginbutton.disabled=e}var v=null;async function h(){if(!self.loginbutton.disabled){var e=!1,t=null;try{let o=function(e,t="user_name_or_password_not_filled_in"){const o=document.getElementById(e);return""===o.value&&(c(t,"red"),o.focus(),!0)};if(v&&(v(),await p(10)),o("username"))return;if(o("password"))return;if(self.password.value.length>128)return void c("password_too_long","red");if(g()){{const e=self.password.value;if(e.length<12||!/[a-z]/.test(e)||!/[A-Z]/.test(e)||!/[0-9]/.test(e))return void c("password_strength_is_insufficient","red")}if(o("repeat_password"))return;if(o("verification_code","the_verification_code_is_not_entered"))return;if(self.password.value!==self.repeat_password.value)return void c("do_not_enter_two_different_passwords","red")}w(!0),c("attempting_to_login","gray");const n={secure:isSecureContext,isregister:g(),username:self.username.value,password:self.password.value,verification_code:self.verification_code.value},s=new AbortController;v=()=>{e=!0,s?.abort()},t=setTimeout((()=>{w(!1)}),1300);const i=await fetch(m.login_api,{method:"POST",body:JSON.stringify(n),signal:s.signal});if(i.ok)c("login_succeeded",document.children[0].classList.contains("dark")?"lightgreen":"green"),w(!0),m.login_success_redirect();else{if(401!=i.status)throw i.status;{console.error(401);const e=(await i.text()).trim();if(""==e)throw 401;c(e,"red"),await p(1e3),w(!1)}}}catch(o){if(e)return;console.error(o),c("login_failed","red",{error:String(o)}),w(!1)}finally{null!=t&&clearTimeout(t),v=null}}}const y=self.matchMedia("(prefers-color-scheme: dark)");let L="";try{L=(await(await fetch("../api-login/color-scheme")).text()).trim()}catch(S){console.error(S)}function b(){e(document.children[0],L?"dark"==L:y.matches,"dark")}b(),L||y.addEventListener("change",b),self.loading_style?.remove();const E=document.createElement("template");async function T(){function e(e,t){switch(typeof t){case"function":var o=e=>{"Enter"==e.key&&t()};break;case"string":o=e=>{"Enter"==e.key&&document.getElementById(t).focus()};break;default:throw new TypeError("Don't input other type to func!")}document.getElementById(e).addEventListener("keyup",o)}function t(e){a(e.target.id.replace("changeLang_",""))}e("username","password"),e("password",(()=>{g()?self.repeat_password.focus():h()})),e("repeat_password","verification_code"),e("verification_code",h),self.loginbutton.addEventListener("click",h),self.loginTitleLogin.addEventListener("click",(()=>u(!1))),self.loginTitleRegister.addEventListener("click",(()=>u(!0)));for(const n of o.concat("default"))document.getElementById("changeLang_"+n)?.addEventListener("click",t);self.footer.appendChild(E.content.cloneNode(!0)),self.addEventListener("resize",l),f(!0,self.divmain),d()}E.innerHTML=await(await fetch("./config/footer.html")).text(),"loading"==document.readyState?document.addEventListener("DOMContentLoaded",T):await T();
